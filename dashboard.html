<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MentiConn Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" crossorigin="anonymous"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    colors: { dark: '#020617', card: '#0f172a', accent: '#6366f1', neon: '#06b6d4', success: '#10b981' }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020617; color: white; }
        .glass-panel { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.05); }
        .active-nav { background: #6366f1 !important; color: white !important; box-shadow: 0 0 15px rgba(99, 102, 241, 0.4); }
        .typing-dot { animation: bounce 1.4s infinite ease-in-out both; }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .live-ring { box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.7); animation: pulse-green 2s infinite; }
        @keyframes pulse-green { 0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(6, 182, 212, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(6, 182, 212, 0); } 100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(6, 182, 212, 0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="flex h-screen overflow-hidden text-sm">

    <aside id="sidebar" class="w-64 bg-card border-r border-gray-800 flex flex-col transition-all duration-300 relative hidden md:flex">
        <div class="p-6 flex items-center justify-between">
            <h1 class="font-bold text-xl tracking-tight text-white">MentiConn<span class="text-neon">.ai</span></h1>
            <button onclick="document.getElementById('sidebar').classList.toggle('hidden')" class="text-gray-500 hover:text-white"><i class="fas fa-chevron-left"></i></button>
        </div>

        <div class="px-4 mb-4">
            <div class="glass-panel p-3 rounded-xl border border-gray-700 bg-gradient-to-br from-gray-800 to-transparent">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xs text-gray-400">Profile Strength</span>
                    <span class="text-xs font-bold text-green-400">85%</span>
                </div>
                <div class="w-full bg-gray-700 rounded-full h-1.5 mb-3">
                    <div class="bg-green-400 h-1.5 rounded-full" style="width: 85%"></div>
                </div>
                <div class="flex justify-between text-xs">
                    <div class="text-center"><p class="font-bold text-white">12</p><p class="text-gray-500">Streak</p></div>
                    <div class="text-center"><p class="font-bold text-white">4</p><p class="text-gray-500">Badges</p></div>
                    <div class="text-center"><p class="font-bold text-white">850</p><p class="text-gray-500">XP</p></div>
                </div>
            </div>
        </div>

        <nav class="flex-1 px-3 space-y-1 overflow-y-auto">
            <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 ml-2">Menu</p>
            <button onclick="nav('feed')" id="nav-feed" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-stream w-4 text-center"></i> Feed</button>
            
            <div id="student-menu">
                <button onclick="nav('mentor-connect')" id="nav-mentor-connect" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-robot w-4 text-center text-neon"></i> AI Mentors</button>
                <button onclick="nav('real-mentors')" id="nav-real-mentors" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-users w-4 text-center"></i> Real Mentors</button>
                <button onclick="nav('fellow-connect')" id="nav-fellow-connect" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-graduation-cap w-4 text-center"></i> Fellow Connect</button>
            </div>
            
            <div id="mentor-menu" class="hidden">
                <button onclick="nav('students-list')" id="nav-students-list" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-user-graduate w-4 text-center text-neon"></i> My Students</button>
            </div>

            <button onclick="nav('jobs')" id="nav-jobs" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-briefcase w-4 text-center"></i> Job Tools</button>
            <button onclick="nav('repos')" id="nav-repos" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-code-branch w-4 text-center"></i> Project Repos</button>

            <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest mb-2 ml-2 mt-4">Social</p>
            <button onclick="nav('messages')" id="nav-messages" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-comment-alt w-4 text-center"></i> Messages <span class="bg-red-500 text-white text-[10px] px-1.5 rounded-full ml-auto">2</span></button>
            <button onclick="nav('connections')" id="nav-connections" class="nav-item w-full text-left px-4 py-2.5 rounded-lg text-gray-400 hover:bg-white/5 hover:text-white flex items-center gap-3 transition"><i class="fas fa-network-wired w-4 text-center"></i> Connections</button>
        </nav>

        <div class="p-4 border-t border-gray-800 cursor-pointer hover:bg-white/5 transition" onclick="toggleRole()">
            <div class="flex items-center gap-3">
                <div id="profileAvatar" class="w-9 h-9 rounded-full bg-gradient-to-tr from-accent to-neon flex items-center justify-center font-bold text-white shadow-lg">U</div>
                <div class="nav-text">
                    <p id="profileName" class="text-sm font-bold text-white">User</p>
                    <p id="profileRole" class="text-[10px] text-gray-400 uppercase tracking-wide">Student Account</p>
                </div>
                <i class="fas fa-exchange-alt text-gray-500 text-xs ml-auto"></i>
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative bg-dark">
        <header class="h-16 border-b border-gray-800 flex items-center justify-between px-6 bg-dark/95 backdrop-blur z-10 sticky top-0">
            <h2 id="pageTitle" class="text-lg font-bold text-white tracking-wide">Feed</h2>
            <div class="flex items-center gap-4">
                <div class="hidden md:flex items-center bg-gray-800 rounded-full px-3 py-1.5 border border-gray-700">
                    <i class="fas fa-coins text-yellow-400 mr-2 text-xs"></i>
                    <span class="text-xs font-bold text-white">240 Credits</span>
                </div>
                <button class="text-gray-400 hover:text-white relative">
                    <i class="fas fa-bell text-lg"></i>
                    <span id="notifDot" class="absolute -top-0.5 -right-0.5 w-2.5 h-2.5 bg-red-500 rounded-full border-2 border-dark hidden"></span>
                </button>
            </div>
        </header>

        <div id="content" class="flex-1 overflow-y-auto p-4 md:p-8 scroll-smooth">

            <div id="view-feed" class="view-section max-w-3xl mx-auto space-y-6">
                <div class="glass-panel p-4 rounded-xl flex flex-col gap-3 mb-6 border border-gray-700/50 relative">
                    <div class="flex gap-3 w-full">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-accent to-neon flex-shrink-0 flex items-center justify-center font-bold text-white shadow-lg" id="feedAvatar">U</div>
                        <div class="flex-1">
                            <textarea id="postInput" class="bg-transparent border-none focus:ring-0 text-white w-full text-sm resize-none" rows="2" placeholder="Start a post, share your project..."></textarea>
                        </div>
                    </div>
                    
                    <div id="imagePreview" class="hidden mb-2 relative">
                        <img id="previewImg" src="" class="max-h-60 rounded-lg border border-gray-700 object-cover">
                        <button onclick="clearImage()" class="absolute top-2 right-2 bg-black/70 hover:bg-red-500 text-white rounded-full p-1 w-6 h-6 flex items-center justify-center transition"><i class="fas fa-times text-xs"></i></button>
                    </div>

                    <div class="flex justify-between items-center border-t border-gray-700/50 pt-3">
                        <div class="flex gap-4 text-gray-400">
                            <input type="file" id="postFile" class="hidden" accept="image/*" onchange="handleFileSelect(this)">
                            <button onclick="document.getElementById('postFile').click()" class="hover:text-accent transition flex items-center gap-2 text-xs font-bold"><i class="fas fa-image text-blue-400"></i> Media</button>
                            <button class="hover:text-accent transition flex items-center gap-2 text-xs font-bold"><i class="fas fa-calendar-alt text-orange-400"></i> Event</button>
                            <button class="hover:text-accent transition flex items-center gap-2 text-xs font-bold"><i class="fas fa-poll text-green-400"></i> Poll</button>
                        </div>
                        <button onclick="createPost()" class="bg-accent hover:bg-indigo-600 text-white px-6 py-1.5 rounded-full text-xs font-bold transition shadow-lg shadow-accent/20">Post</button>
                    </div>
                </div>

                <div id="feedContainer" class="space-y-6"></div>
                <div class="text-center p-4">
                    <button class="text-gray-500 hover:text-white text-xs uppercase tracking-widest font-bold animate-pulse">Load More</button>
                </div>
            </div>

            <div id="view-mentor-connect" class="view-section hidden h-full flex flex-col max-w-4xl mx-auto">
                <div class="glass-panel p-4 rounded-t-xl border-b border-gray-700 flex justify-between items-center bg-gray-900/50">
                    <div class="flex items-center gap-4">
                        <div class="live-ring rounded-full">
                            <div class="w-12 h-12 rounded-full overflow-hidden border-2 border-neon bg-gray-800">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="AI">
                            </div>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-white">Nexus AI <span class="text-[10px] bg-green-500/20 text-green-400 border border-green-500/30 px-2 py-0.5 rounded ml-2">ONLINE</span></h3>
                            <p class="text-xs text-gray-400">Current Mode: <span id="chatModeLabel" class="text-neon font-bold">Mentorship</span></p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                         <button onclick="setChatMode('mentor')" class="text-xs bg-gray-800 border border-gray-700 text-gray-300 px-3 py-1.5 rounded hover:bg-white/10 transition">Mentor Mode</button>
                         <button onclick="setChatMode('interviewer')" class="text-xs bg-gray-800 border border-gray-700 text-gray-300 px-3 py-1.5 rounded hover:bg-red-500/20 hover:text-red-400 hover:border-red-500 transition">Interviewer Mode</button>
                    </div>
                </div>
                <div id="chatBox" class="flex-1 bg-black/40 overflow-y-auto p-6 space-y-6">
                    <div class="flex gap-4">
                        <div class="w-8 h-8 rounded-full bg-gray-700 overflow-hidden flex-shrink-0 mt-1"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"></div>
                        <div class="glass-panel p-4 text-sm text-gray-200 rounded-r-2xl rounded-bl-2xl max-w-[85%] leading-relaxed border-l-4 border-neon">
                            Namaste! I'm Nexus. I can review your resume, run a mock interview, or help you solve that bug. What's the plan?
                        </div>
                    </div>
                </div>
                <div class="p-4 bg-gray-900 rounded-b-xl border-t border-gray-700">
                    <form onsubmit="sendMessage(event)" class="flex gap-2 relative">
                        <input id="chatInput" type="text" class="flex-1 bg-gray-800 border border-gray-700 rounded-xl p-4 pr-12 text-white focus:outline-none focus:border-neon focus:ring-1 focus:ring-neon transition placeholder-gray-500" placeholder="Type your message..." autocomplete="off">
                        <button type="submit" class="absolute right-2 top-2 bottom-2 bg-neon/10 hover:bg-neon text-neon hover:text-white px-4 rounded-lg transition"><i class="fas fa-paper-plane"></i></button>
                    </form>
                </div>
            </div>

            <div id="view-real-mentors" class="view-section hidden max-w-6xl mx-auto">
                <div class="flex justify-between items-end mb-6">
                    <div>
                        <h3 class="text-2xl font-bold text-white">Connect with Seniors</h3>
                        <p class="text-gray-400 text-xs mt-1">Book 1:1 sessions with verified pros.</p>
                    </div>
                    <select class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-1 text-xs"><option>Sort by: Rating</option><option>Sort by: Price</option></select>
                </div>
                <div id="mentorGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
            </div>

            <div id="view-fellow-connect" class="view-section hidden max-w-5xl mx-auto">
                <div class="glass-panel p-5 rounded-xl mb-8 flex flex-wrap gap-4 items-center border-l-4 border-accent">
                    <span class="text-sm font-bold text-white"><i class="fas fa-filter mr-2"></i>Filter By:</span>
                    <select id="roleFilter" onchange="applyFilters()" class="bg-dark border border-gray-700 text-gray-300 text-sm rounded-lg p-2 focus:border-accent outline-none"><option value="all">All Roles</option><option value="SDE">SDE</option><option value="Data">Data Scientist</option><option value="Cyber">Cyber Security</option></select>
                    <select class="bg-dark border border-gray-700 text-gray-300 text-sm rounded-lg p-2 focus:border-accent outline-none"><option>All Colleges</option><option>Same College</option></select>
                </div>
                <div id="fellowList" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
            </div>

            <div id="view-jobs" class="view-section hidden max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-3 gap-6">
                <div onclick="startMockInterview()" class="glass-panel p-8 rounded-2xl hover:border-accent transition cursor-pointer text-center group border border-transparent hover:bg-white/5">
                    <div class="w-16 h-16 rounded-full bg-accent/10 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition"><i class="fas fa-user-tie text-3xl text-accent"></i></div>
                    <h3 class="font-bold text-xl text-white">AI Interviewer</h3>
                    <p class="text-xs text-gray-400 mt-2 leading-relaxed">Select a role (SDE, PM) and get grilled by AI. Receive a score out of 100.</p>
                    <div class="mt-4 text-accent text-xs font-bold group-hover:underline">Start Session &rarr;</div>
                </div>
                <div onclick="uploadResume()" class="glass-panel p-8 rounded-2xl hover:border-neon transition cursor-pointer text-center group border border-transparent hover:bg-white/5">
                    <div class="w-16 h-16 rounded-full bg-neon/10 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition"><i class="fas fa-file-contract text-3xl text-neon"></i></div>
                    <h3 class="font-bold text-xl text-white">Evaluate CV</h3>
                    <p class="text-xs text-gray-400 mt-2 leading-relaxed">Check ATS compliance. Identify weak spots and get instant fixes.</p>
                    <div class="mt-4 text-neon text-xs font-bold group-hover:underline">Upload PDF &rarr;</div>
                </div>
                <div onclick="showRoadmap()" class="glass-panel p-8 rounded-2xl hover:border-green-400 transition cursor-pointer text-center group border border-transparent hover:bg-white/5">
                    <div class="w-16 h-16 rounded-full bg-green-500/10 flex items-center justify-center mx-auto mb-4 group-hover:scale-110 transition"><i class="fas fa-map-signs text-3xl text-green-400"></i></div>
                    <h3 class="font-bold text-xl text-white">Roadmap</h3>
                    <p class="text-xs text-gray-400 mt-2 leading-relaxed">Step-by-step path to your dream role. Curated by industry pros.</p>
                    <div class="mt-4 text-green-400 text-xs font-bold group-hover:underline">Generate &rarr;</div>
                </div>
            </div>

             <div id="view-repos" class="view-section hidden max-w-4xl mx-auto space-y-6">
                 <div class="flex justify-between items-center bg-gradient-to-r from-gray-800 to-transparent p-6 rounded-xl border border-gray-700">
                     <div>
                         <h3 class="text-2xl font-bold text-white">Marketplace</h3>
                         <p class="text-xs text-gray-400 mt-1">Buy & Sell High-Quality Codebases</p>
                     </div>
                     <button onclick="openUploadModal()" class="bg-white text-dark font-bold px-6 py-2.5 rounded-xl hover:bg-gray-200 transition shadow-lg"><i class="fas fa-plus mr-2"></i> Upload Repo</button>
                 </div>
                 <div id="repoList" class="space-y-4"></div>
            </div>
            
             <div id="view-connections" class="view-section hidden max-w-4xl mx-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-bold text-white">My Connections</h3>
                    <select class="bg-dark border border-gray-700 text-sm rounded-lg p-2"><option>All</option><option>Mentors</option><option>Fellows</option></select>
                </div>
                <div id="connectionsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="glass-panel p-12 rounded-xl text-center text-gray-500 border-dashed border-2 border-gray-800 col-span-2">
                        <i class="fas fa-users-slash text-4xl mb-3"></i>
                        <p>No connections yet. Go to "Fellow Connect"!</p>
                    </div>
                </div>
            </div>
            
            <div id="view-messages" class="view-section hidden max-w-5xl mx-auto h-[80vh] glass-panel rounded-2xl flex overflow-hidden border border-gray-800 shadow-2xl">
                <div class="w-1/3 border-r border-gray-800 bg-gray-900/50 flex flex-col">
                    <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-gray-900/80">
                        <span class="font-bold text-white">Chats</span>
                        <div class="flex gap-2 text-gray-400">
                            <i class="fas fa-edit cursor-pointer hover:text-white"></i>
                            <i class="fas fa-cog cursor-pointer hover:text-white"></i>
                        </div>
                    </div>
                    <div class="p-3">
                        <input type="text" placeholder="Search..." class="w-full bg-gray-800 border border-gray-700 rounded-lg p-2 text-xs text-white focus:outline-none focus:border-gray-600">
                    </div>
                    <div class="overflow-y-auto flex-1 no-scrollbar" id="msgContactList">
                        </div>
                </div>
                
                <div class="flex-1 flex flex-col relative bg-black/40">
                    <div class="p-4 border-b border-gray-800 flex justify-between items-center bg-gray-900/90 backdrop-blur">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-purple-600 flex items-center justify-center font-bold text-white text-sm shadow-md" id="chatHeaderAvatar">A</div>
                            <div>
                                <h4 class="font-bold text-white text-sm" id="activeChatName">Select a chat</h4>
                                <p class="text-[10px] text-green-400 flex items-center gap-1" id="activeChatStatus"><span class="w-1.5 h-1.5 bg-green-400 rounded-full"></span> Online</p>
                            </div>
                        </div>
                        <div class="flex gap-4 text-gray-400 text-sm">
                            <i class="fas fa-phone hover:text-white cursor-pointer"></i>
                            <i class="fas fa-video hover:text-white cursor-pointer"></i>
                            <i class="fas fa-info-circle hover:text-white cursor-pointer"></i>
                        </div>
                    </div>
                    
                    <div class="flex-1 p-6 overflow-y-auto space-y-4" id="messageContainer">
                        <div class="flex h-full items-center justify-center text-gray-500 flex-col">
                            <i class="fas fa-paper-plane text-4xl mb-3 opacity-50"></i>
                            <p>Send a message to start chatting</p>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-900 border-t border-gray-800">
                        <div class="flex gap-3 items-end bg-gray-800/50 p-2 rounded-xl border border-gray-700">
                            <button class="text-gray-400 hover:text-white p-2"><i class="fas fa-plus-circle text-lg"></i></button>
                            <textarea id="msgInput" onkeypress="handleMsgKey(event)" rows="1" class="flex-1 bg-transparent border-none text-sm text-white focus:ring-0 resize-none py-2 max-h-24" placeholder="Type a message..."></textarea>
                            <button class="text-gray-400 hover:text-white p-2"><i class="far fa-smile text-lg"></i></button>
                            <button onclick="sendDirectMessage()" class="bg-accent hover:bg-indigo-600 text-white p-2 rounded-lg transition shadow-lg"><i class="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-students-list" class="view-section hidden max-w-4xl mx-auto">
                <h3 class="text-xl font-bold mb-6 text-white">Your Classroom</h3>
                <div class="glass-panel p-12 rounded-xl text-center border-dashed border-2 border-gray-700">
                    <i class="fas fa-user-graduate text-5xl text-gray-600 mb-4"></i>
                    <h4 class="text-lg font-bold text-gray-400">No active students yet</h4>
                    <p class="text-sm text-gray-500 mt-2">Students who book your sessions will appear here.</p>
                </div>
            </div>

        </div>
    </main>

    <script>
        // CONFIG
        const API_KEY = "sk-v1-b6cdcd8b1ed348f41c057ead65995ec87bfaa2e3ddf7bdea3c75fd5fa86e18c0"; 
        
        let user = JSON.parse(localStorage.getItem('mc_user')) || { name: 'Guest', role: 'student', startPage: 'feed' };
        let chatMode = 'mentor';
        let interviewRole = 'SDE';
        let connections = []; 

        // DATA ARRAYS
        // NOTE: 'image' data is handled via createPost, but initial data can exist too.
        let feedData = [
            { 
                name: "Rahul Sharma", role: "SDE @ Google", time: "2h", type: "video", 
                content: "The biggest mistake in interviews? Not explaining your *individual* contribution. Recruiters don't care about 'We', they care about 'I'. #InterviewTips", 
                color: "blue", likes: 245, comments: 42 
            },
            { 
                name: "System", role: "MentiConn", time: "5h", type: "poll", 
                content: "Poll: Which stack is in higher demand for 2026 grads?", 
                color: "purple", likes: 890, comments: 120,
                isPoll: true 
            },
            { 
                name: "Priya Singh", role: "HR @ Microsoft", time: "1d", type: "image", 
                content: "We are officially opening applications for Summer 2026! Check the careers page. DM for referrals if you have a strong GitHub profile.", 
                color: "green", likes: 1200, comments: 500,
                hasImage: true // Dummy flag, real uploads use Base64
            }
        ];

        const mentorsData = [
            { name: "Aditi Verma", role: "PM @ Zomato", price: 300, pkg: 850, color: "purple" },
            { name: "Vikram Malhotra", role: "SDE II @ Amazon", price: 500, pkg: 1400, color: "yellow" },
            { name: "Sarah Khan", role: "Backend @ Cred", price: 450, pkg: 1200, color: "pink" }
        ];

        const repoData = [
            { name: "Swiggy Clone", stack: "MERN Stack", price: 799, type: "Paid", size: "12 MB" },
            { name: "DSA Sheet 450", stack: "C++ / Java", price: 0, type: "Free", size: "2 MB" },
            { name: "Uber System Design", stack: "Architecture", price: 499, type: "Paid", size: "8 MB" }
        ];

        const fellowsData = [
            { id: 1, name: "Rohan Das", role: "SDE", college: "Pune Univ", target: "Amazon" },
            { id: 2, name: "Sneha P.", role: "Data", college: "IIT Bombay", target: "Google" },
            { id: 3, name: "Arjun K.", role: "Cyber", college: "VIT", target: "CrowdStrike" },
            { id: 4, name: "Meera S.", role: "SDE", college: "SRM", target: "Startups" }
        ];

        // INIT
        window.onload = function() {
            document.getElementById('profileName').innerText = user.name;
            document.getElementById('profileRole').innerText = user.role.toUpperCase();
            document.getElementById('profileAvatar').innerText = user.name.charAt(0);
            document.getElementById('feedAvatar').innerText = user.name.charAt(0); // For Feed input

            if(user.role === 'mentor') {
                document.getElementById('student-menu').classList.add('hidden');
                document.getElementById('mentor-menu').classList.remove('hidden');
            } else {
                document.getElementById('student-menu').classList.remove('hidden');
                document.getElementById('mentor-menu').classList.add('hidden');
            }
            
            renderFeed();
            renderMentors();
            renderRepos();
            renderFellows();
            renderConnections();
            
            // Populate Dummy Chat Contacts
            const contactList = document.getElementById('msgContactList');
            contactList.innerHTML = `
                <div onclick="selectChat('Aditi Verma', 'PM @ Zomato')" class="p-4 hover:bg-white/5 cursor-pointer border-l-2 border-accent bg-white/5 transition">
                    <div class="flex justify-between"><h4 class="font-bold text-sm text-white">Aditi Verma</h4><span class="text-[10px] text-gray-500">10:42 AM</span></div>
                    <p class="text-xs text-gray-400 truncate">Looking forward to our session tomorrow!</p>
                </div>
                <div onclick="selectChat('Rohan Das', 'Student')" class="p-4 hover:bg-white/5 cursor-pointer border-l-2 border-transparent transition">
                    <div class="flex justify-between"><h4 class="font-bold text-sm text-white">Rohan Das</h4><span class="text-[10px] text-gray-500">Yesterday</span></div>
                    <p class="text-xs text-gray-400 truncate">Thanks for the connection!</p>
                </div>
            `;

            nav(user.startPage);
        };

        // NAV
        function nav(id) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + id).classList.remove('hidden');
            document.getElementById('pageTitle').innerText = id.replace('view-', '').replace('-', ' ').toUpperCase();
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active-nav'));
            document.getElementById('nav-' + id).classList.add('active-nav');
        }

        function toggleRole() {
            const newRole = user.role === 'student' ? 'mentor' : 'student';
            user.role = newRole;
            localStorage.setItem('mc_user', JSON.stringify(user));
            location.reload();
        }

        // --- FEED LOGIC (Create Post with Image) ---
        let selectedFile = null;

        function handleFileSelect(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').classList.remove('hidden');
                    selectedFile = e.target.result; // Store Base64
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        function clearImage() {
            document.getElementById('postFile').value = '';
            document.getElementById('imagePreview').classList.add('hidden');
            selectedFile = null;
        }

        function createPost() {
            const text = document.getElementById('postInput').value;
            if(!text && !selectedFile) return;

            const newPost = {
                name: user.name,
                role: user.role === 'student' ? "Student" : "Mentor",
                time: "Just now",
                type: selectedFile ? "image" : "text",
                content: text,
                color: "indigo", // User color
                likes: 0,
                comments: 0,
                imageSrc: selectedFile
            };

            feedData.unshift(newPost);
            renderFeed();
            
            // Reset
            document.getElementById('postInput').value = '';
            clearImage();
            
            Swal.fire({
                toast: true, position: 'top-end', icon: 'success', 
                title: 'Post Published', showConfirmButton: false, timer: 1500,
                background: '#1e293b', color: '#fff'
            });
        }

        function renderFeed() {
            document.getElementById('feedContainer').innerHTML = feedData.map(post => `
                <div class="glass-panel p-6 rounded-xl animate-fade-in border border-gray-700/50">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-full bg-${post.color || 'blue'}-600 flex items-center justify-center font-bold text-white relative">
                            ${post.name.charAt(0)}
                            <span class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-gray-900 rounded-full"></span>
                        </div>
                        <div>
                            <h4 class="font-bold text-white text-sm flex items-center gap-1">
                                ${post.name} 
                                ${post.name !== 'System' ? '<i class="fas fa-check-circle text-blue-400 text-xs"></i>' : ''}
                            </h4>
                            <p class="text-[10px] text-gray-400">${post.role} • ${post.time}</p>
                        </div>
                        <button class="ml-auto text-gray-500 hover:text-white"><i class="fas fa-ellipsis-h"></i></button>
                    </div>
                    
                    <div class="text-gray-300 text-sm mb-4 leading-relaxed">${marked.parse(post.content || "")}</div>
                    
                    ${post.imageSrc ? `
                    <div class="rounded-lg overflow-hidden mb-4 border border-gray-700">
                        <img src="${post.imageSrc}" class="w-full h-auto max-h-96 object-cover">
                    </div>` : ''}

                    ${post.hasImage && !post.imageSrc ? `
                    <div class="h-48 bg-gradient-to-r from-green-900 to-slate-900 rounded-lg flex items-center justify-center mb-4 border border-gray-700">
                        <i class="fas fa-image text-4xl text-white/20"></i>
                    </div>` : ''}

                    ${post.type === 'video' ? `
                    <div class="bg-black rounded-lg h-64 flex items-center justify-center relative group cursor-pointer overflow-hidden mb-4 border border-gray-700">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                        <i class="fas fa-play-circle text-5xl text-white/80 group-hover:scale-110 transition duration-300"></i>
                        <span class="absolute bottom-3 right-3 bg-black/70 text-white text-xs px-2 py-1 rounded">04:20</span>
                    </div>` : ''}

                    ${post.isPoll ? `
                    <div class="space-y-2 mb-4">
                        <div class="bg-gray-800 p-3 rounded-lg text-sm flex justify-between cursor-pointer hover:bg-gray-700 border border-gray-600"><span>MERN Stack</span> <span>62%</span></div>
                        <div class="bg-gray-800 p-3 rounded-lg text-sm flex justify-between cursor-pointer hover:bg-gray-700 border border-gray-600"><span>Java Spring</span> <span>28%</span></div>
                        <div class="bg-gray-800 p-3 rounded-lg text-sm flex justify-between cursor-pointer hover:bg-gray-700 border border-gray-600"><span>Go / Rust</span> <span>10%</span></div>
                        <p class="text-xs text-gray-500 mt-1">1,204 votes • 2 days left</p>
                    </div>` : ''}

                    <div class="flex items-center justify-between pt-4 border-t border-gray-700/50">
                        <div class="flex gap-6 text-xs font-bold text-gray-400">
                            <button class="hover:text-pink-500 flex items-center gap-2 transition group"><i class="far fa-heart group-hover:animate-bounce"></i> ${post.likes}</button>
                            <button class="hover:text-blue-400 flex items-center gap-2 transition"><i class="far fa-comment-alt"></i> ${post.comments}</button>
                            <button class="hover:text-green-400 flex items-center gap-2 transition"><i class="fas fa-share"></i> Share</button>
                        </div>
                    </div>
                </div>`).join('');
        }

        function renderMentors() {
            document.getElementById('mentorGrid').innerHTML = mentorsData.map(m => `
                <div class="glass-panel p-6 rounded-xl text-center hover:border-neon/30 transition border border-transparent">
                    <div class="w-20 h-20 rounded-full bg-${m.color}-600 mx-auto mb-3 flex items-center justify-center text-2xl font-bold">${m.name.charAt(0)}</div>
                    <h4 class="font-bold text-white">${m.name}</h4>
                    <p class="text-xs text-gray-400 mb-4">${m.role}</p>
                    <div class="bg-black/30 p-3 rounded-lg text-left text-xs mb-4 flex justify-between">
                        <span>1 Session: <b class="text-neon">₹${m.price}</b></span>
                        <span>3 Sessions: <b class="text-green-400">₹${m.pkg}</b></span>
                    </div>
                    <button onclick="bookMentor('${m.name}', ${m.price})" class="w-full bg-neon/10 hover:bg-neon text-neon hover:text-black py-2 rounded-lg font-bold text-xs transition">Book</button>
                </div>`).join('');
        }

        // --- PAYMENT POPUP ---
        async function bookMentor(name, price) {
            const { value: paymentMethod } = await Swal.fire({
                title: `Book Session with ${name}`,
                html: `
                    <div class="text-left bg-black/20 p-4 rounded-xl mb-4">
                        <div class="flex justify-between text-sm mb-2"><span>Session Fee</span><span>₹${price}</span></div>
                        <div class="flex justify-between text-sm font-bold text-neon border-t border-gray-600 pt-2"><span>Total</span><span>₹${price}</span></div>
                    </div>
                    <p class="text-xs text-gray-400 mb-2">Select Payment Method</p>
                    <div class="flex gap-4 justify-center">
                        <label class="flex items-center gap-2 cursor-pointer bg-gray-700 p-2 rounded hover:bg-gray-600 transition">
                            <input type="radio" name="swal-radio" value="upi" class="accent-neon">
                            <span class="text-sm">UPI / GPay</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer bg-gray-700 p-2 rounded hover:bg-gray-600 transition">
                            <input type="radio" name="swal-radio" value="card" class="accent-neon">
                            <span class="text-sm">Card</span>
                        </label>
                    </div>
                `,
                confirmButtonText: `Pay ₹${price}`,
                confirmButtonColor: '#10b981',
                background: '#1e293b', color: '#fff',
                showCancelButton: true,
                preConfirm: () => {
                    const selected = document.querySelector('input[name="swal-radio"]:checked');
                    if (!selected) {
                        Swal.showValidationMessage('Please select a payment method');
                    }
                    return selected ? selected.value : null;
                }
            });

            if (paymentMethod) {
                Swal.fire({
                    title: 'Processing...',
                    timer: 2000,
                    timerProgressBar: true,
                    didOpen: () => Swal.showLoading(),
                    background: '#1e293b', color: '#fff'
                }).then(() => {
                    Swal.fire({
                        title: 'Payment Successful!',
                        text: 'Meeting link has been sent to your email.',
                        icon: 'success',
                        background: '#1e293b', color: '#fff'
                    });
                });
            }
        }

        // --- CONNECT & FILTER ---
        function renderFellows() {
            const roleFilter = document.getElementById('roleFilter').value;
            const container = document.getElementById('fellowList');
            const filtered = fellowsData.filter(f => roleFilter === 'all' || f.role === roleFilter);
            container.innerHTML = filtered.map(f => {
                const isConnected = connections.some(c => c.id === f.id);
                return `
                <div class="fellow-card glass-panel p-4 rounded-xl flex items-center gap-4 animate-fade-in">
                    <div class="w-12 h-12 rounded-full bg-gray-700 flex items-center justify-center font-bold text-gray-400">${f.name.charAt(0)}</div>
                    <div><h4 class="font-bold text-sm text-white">${f.name}</h4><p class="text-[10px] text-gray-400">${f.college}</p><p class="text-[10px] text-neon mt-0.5">${f.role}</p></div>
                    <button onclick="connectFellow(${f.id})" id="btn-${f.id}" 
                        class="ml-auto px-3 py-1.5 rounded-lg text-xs transition border ${isConnected ? 'bg-green-600 text-white border-green-600' : 'bg-gray-800 text-gray-300 border-gray-700 hover:bg-gray-700'}">
                        ${isConnected ? 'Connected' : 'Connect'}
                    </button>
                </div>`;
            }).join('');
        }

        function applyFilters() { renderFellows(); }

        function connectFellow(id) {
            const person = fellowsData.find(f => f.id === id);
            if(!connections.some(c => c.id === id)) {
                connections.push(person);
                const btn = document.getElementById(`btn-${id}`);
                btn.className = "ml-auto px-3 py-1.5 rounded-lg text-xs transition border bg-green-600 text-white border-green-600";
                btn.innerText = "Connected";
                renderConnections();
                Swal.fire({ toast: true, position: 'top-end', icon: 'success', title: `Connected with ${person.name}`, showConfirmButton: false, timer: 1500, background: '#1e293b', color: '#fff' });
            }
        }

        function renderConnections() {
            const list = document.getElementById('connectionsList');
            if(connections.length === 0) {
                list.innerHTML = `<div class="glass-panel p-12 rounded-xl text-center text-gray-500 border-dashed border-2 border-gray-800 col-span-2"><i class="fas fa-users-slash text-4xl mb-3"></i><p>No connections yet.</p></div>`;
            } else {
                list.innerHTML = connections.map(c => `
                    <div class="glass-panel p-4 rounded-xl flex items-center gap-3 animate-fade-in">
                        <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center font-bold text-white">${c.name.charAt(0)}</div>
                        <div><h4 class="font-bold text-sm text-white">${c.name}</h4><p class="text-xs text-gray-400">${c.role}</p></div>
                        <button onclick="selectChat('${c.name}', '${c.role}')" class="ml-auto text-gray-400 hover:text-white"><i class="fas fa-comment-dots"></i></button>
                    </div>
                `).join('');
            }
        }

        // --- REAL JOB TOOLS ---
        async function uploadResume() {
            const { value: text } = await Swal.fire({ 
                title: 'Paste Resume Text', 
                input: 'textarea', 
                inputPlaceholder: 'Paste your full resume content here...',
                confirmButtonText: 'Analyze with AI',
                background: '#1e293b', color: '#fff' 
            });
            if(text) {
                Swal.fire({ title: 'Analyzing...', didOpen: () => Swal.showLoading(), background: '#1e293b', color: '#fff' });
                try {
                    const res = await fetch("https://go.fastrouter.ai/api/v1/chat/completions", {
                        method: "POST", 
                        headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                        body: JSON.stringify({
                            "model": "openai/gpt-4o",
                            "messages": [ 
                                { "role": "system", "content": "You are an expert Resume Reviewer. Give a score out of 100, then list 3 Strengths and 3 Critical Weaknesses. Format as Markdown." }, 
                                { "role": "user", "content": text } 
                            ]
                        })
                    });
                    const data = await res.json();
                    Swal.fire({ 
                        title: 'Resume Analysis', 
                        html: `<div class="text-left text-sm max-h-60 overflow-y-auto">${marked.parse(data.choices[0].message.content)}</div>`, 
                        background: '#1e293b', color: '#fff', width: 600
                    });
                } catch(e) { Swal.fire('Error', 'API Failed', 'error'); }
            }
        }

        async function showRoadmap() {
            const { value: role } = await Swal.fire({ 
                title: 'Generate Roadmap', 
                input: 'select', 
                inputOptions: { 'SDE': 'SDE', 'Data Scientist': 'Data Scientist', 'Product Manager': 'Product Manager' },
                confirmButtonText: 'Generate',
                background: '#1e293b', color: '#fff' 
            });
            if(role) {
                Swal.fire({ title: 'Generating...', didOpen: () => Swal.showLoading(), background: '#1e293b', color: '#fff' });
                try {
                    const res = await fetch("https://go.fastrouter.ai/api/v1/chat/completions", {
                        method: "POST", 
                        headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                        body: JSON.stringify({
                            "model": "openai/gpt-4o",
                            "messages": [ 
                                { "role": "system", "content": "Create a 4-step learning roadmap for the requested role. Be concise. Format as Markdown bullets." }, 
                                { "role": "user", "content": `Create a roadmap for ${role}` } 
                            ]
                        })
                    });
                    const data = await res.json();
                    Swal.fire({ 
                        title: `${role} Roadmap`, 
                        html: `<div class="text-left text-sm">${marked.parse(data.choices[0].message.content)}</div>`, 
                        background: '#1e293b', color: '#fff' 
                    });
                } catch(e) { Swal.fire('Error', 'API Failed', 'error'); }
            }
        }

        // --- REAL MESSAGES UI ---
        function selectChat(name, role) {
            document.getElementById('activeChatName').innerText = name;
            document.getElementById('chatHeaderAvatar').innerText = name.charAt(0);
            
            // Clear and add fake history
            const container = document.getElementById('messageContainer');
            container.innerHTML = `
                <div class="flex justify-center my-4"><span class="text-[10px] bg-gray-800 text-gray-400 px-2 py-1 rounded-full">Today</span></div>
                <div class="flex gap-3"><div class="w-8 h-8 rounded-full bg-purple-600 flex-shrink-0 flex items-center justify-center font-bold text-xs">${name.charAt(0)}</div><div class="bg-gray-800 p-3 rounded-r-xl rounded-bl-xl text-sm text-gray-300 max-w-[70%]">Hi! Thanks for connecting.</div></div>
                <div class="flex gap-3 flex-row-reverse"><div class="w-8 h-8 rounded-full bg-accent flex-shrink-0 flex items-center justify-center font-bold text-xs">U</div><div class="bg-accent p-3 rounded-l-xl rounded-br-xl text-sm text-white max-w-[70%]">Hey! Looking forward to learning from you.</div></div>
            `;
            nav('messages'); // Switch to tab
        }

        function handleMsgKey(e) { 
            if(e.key === 'Enter' && !e.shiftKey) { 
                e.preventDefault(); 
                sendDirectMessage(); 
            } 
        }

        function sendDirectMessage() {
            const input = document.getElementById('msgInput');
            const txt = input.value.trim();
            if(!txt) return;
            const container = document.getElementById('messageContainer');
            
            // Add user message
            container.innerHTML += `<div class="flex gap-3 flex-row-reverse animate-fade-in"><div class="w-8 h-8 rounded-full bg-accent flex-shrink-0 flex items-center justify-center font-bold text-xs">U</div><div class="bg-accent p-3 rounded-l-xl rounded-br-xl text-sm text-white max-w-[70%]">${txt}</div></div>`;
            input.value = '';
            
            // Scroll to bottom
            container.scrollTop = container.scrollHeight;
            
            // Simulate reply
            setTimeout(() => {
                container.innerHTML += `<div class="flex gap-3 animate-fade-in"><div class="w-8 h-8 rounded-full bg-purple-600 flex-shrink-0 flex items-center justify-center font-bold text-xs">A</div><div class="bg-gray-800 p-3 rounded-r-xl rounded-bl-xl text-sm text-gray-300 max-w-[70%]"><div class="typing-dot w-1.5 h-1.5 bg-gray-400 rounded-full inline-block"></div></div></div>`;
                container.scrollTop = container.scrollHeight;
                
                setTimeout(() => {
                    container.lastElementChild.innerHTML = `<div class="w-8 h-8 rounded-full bg-purple-600 flex-shrink-0 flex items-center justify-center font-bold text-xs">A</div><div class="bg-gray-800 p-3 rounded-r-xl rounded-bl-xl text-sm text-gray-300 max-w-[70%]">Got it! Let's discuss this in our session.</div>`;
                }, 1500);
            }, 500);
        }

        // --- EXISTING REPO & AI ---
        function renderRepos() {
            document.getElementById('repoList').innerHTML = repoData.map(r => `
                <div class="glass-panel p-4 rounded-xl flex justify-between items-center hover:bg-white/5 transition">
                    <div class="flex items-center gap-4">
                        <div class="w-10 h-10 bg-gray-800 rounded-lg flex items-center justify-center text-lg text-gray-400"><i class="fas fa-folder"></i></div>
                        <div><h4 class="font-bold text-sm text-white">${r.name}</h4><p class="text-[10px] text-gray-400">${r.stack} • <span class="text-gray-500">${r.size}</span> • <span class="${r.type==='Paid'?'text-green-400':'text-gray-500'} font-bold">${r.type}</span></p></div>
                    </div>
                    <div class="flex items-center gap-3"><span class="font-bold text-sm text-white">${r.price > 0 ? '₹'+r.price : 'Free'}</span><button class="bg-accent hover:bg-indigo-600 px-3 py-1.5 rounded-lg text-xs font-bold text-white transition">Get</button></div>
                </div>`).join('');
        }

        window.toggleRepoType = function(type) {
            document.getElementById('priceSection').style.display = type === 'paid' ? 'block' : 'none';
            document.getElementById('freeSection').style.display = type === 'free' ? 'block' : 'none';
        }

        async function openUploadModal() {
            const { value: formValues } = await Swal.fire({
                title: 'Upload Project Repo',
                html: `
                    <div class="text-left space-y-4">
                        <div class="flex gap-4 justify-center bg-black/20 p-3 rounded-xl border border-gray-700">
                            <label class="flex items-center gap-2 cursor-pointer hover:text-neon transition"><input type="radio" name="repoType" value="paid" checked onchange="toggleRepoType('paid')" class="accent-neon"><span class="font-bold text-sm">Paid Repo</span></label>
                            <label class="flex items-center gap-2 cursor-pointer hover:text-green-400 transition"><input type="radio" name="repoType" value="free" onchange="toggleRepoType('free')" class="accent-green-400"><span class="font-bold text-sm">Free / Open Source</span></label>
                        </div>
                        <div class="space-y-2"><input id="swal-name" class="swal2-input w-full mx-0 bg-gray-800 text-white" placeholder="Project Name"><input id="swal-stack" class="swal2-input w-full mx-0 bg-gray-800 text-white" placeholder="Tech Stack"></div>
                        <div id="priceSection" class="animate-fade-in"><input id="swal-price" type="number" class="swal2-input w-full mx-0 bg-gray-800 text-white" placeholder="Price in ₹"><div class="text-red-400 text-xs font-bold mt-2 bg-red-500/10 p-3 rounded border border-red-500/20"><i class="fas fa-info-circle"></i> Note: 15% platform fee applies.</div><div class="mt-4"><label class="block text-xs text-gray-400 mb-1 uppercase font-bold">Project File (ZIP)</label><input type="file" id="swal-file" class="block w-full text-sm text-gray-400 bg-gray-800 rounded-lg"></div></div>
                        <div id="freeSection" class="hidden animate-fade-in space-y-3"><input id="swal-link" class="swal2-input w-full mx-0 bg-gray-800 text-white" placeholder="GitHub Link"><div class="text-center text-gray-500 text-xs">OR</div><textarea id="swal-desc" class="swal2-textarea w-full mx-0 bg-gray-800 text-white" placeholder="Description..." style="height: 80px"></textarea></div>
                    </div>`,
                focusConfirm: false, confirmButtonText: 'Publish', confirmButtonColor: '#6366f1', background: '#1e293b', color: '#fff', showCancelButton: true,
                preConfirm: () => {
                    const type = document.querySelector('input[name="repoType"]:checked').value;
                    const name = document.getElementById('swal-name').value;
                    const stack = document.getElementById('swal-stack').value;
                    if(!name || !stack) { Swal.showValidationMessage('Name/Stack required'); return false; }
                    if(type === 'paid') {
                        const price = document.getElementById('swal-price').value;
                        const file = document.getElementById('swal-file').files[0];
                        if(!price || !file) { Swal.showValidationMessage('Price & File required'); return false; }
                        return { type: 'Paid', name, stack, price, file, size: (file.size/(1024*1024)).toFixed(1)+' MB' };
                    } else {
                        return { type: 'Free', name, stack, price: 0, size: 'Link' };
                    }
                }
            });
            if (formValues) {
                await Swal.fire({ title: 'Processing...', timer: 1500, timerProgressBar: true, background: '#1e293b', color: '#fff', didOpen: () => Swal.showLoading() });
                repoData.unshift(formValues);
                renderRepos();
                Swal.fire({ title: 'Success!', icon: 'success', background: '#1e293b', color: '#fff' });
            }
        }

        function setChatMode(mode) {
            chatMode = mode;
            document.getElementById('chatModeLabel').innerText = mode === 'interviewer' ? "Interviewer" : "Mentorship";
            document.getElementById('chatModeLabel').className = mode === 'interviewer' ? "text-red-400 font-bold" : "text-neon font-bold";
            document.getElementById('chatBox').innerHTML += `<div class="text-center my-4"><span class="bg-gray-800 text-gray-400 text-[10px] px-3 py-1 rounded-full border border-gray-700">Switched to ${mode} Mode</span></div>`;
        }

        async function sendMessage(e) {
            e.preventDefault();
            const input = document.getElementById('chatInput');
            const msg = input.value;
            if(!msg) return;
            const box = document.getElementById('chatBox');
            box.innerHTML += `<div class="flex flex-row-reverse gap-3"><div class="glass-panel p-3 bg-accent text-white rounded-l-xl rounded-br-xl max-w-[80%] text-sm">${msg}</div></div>`;
            input.value = '';
            const loadingId = 'load-'+Date.now();
            box.innerHTML += `<div id="${loadingId}" class="flex gap-3 mt-4"><div class="w-8 h-8 rounded-full bg-gray-700"></div><div class="glass-panel p-3 w-16"><div class="typing-dot w-1.5 h-1.5 bg-gray-400 rounded-full inline-block"></div></div></div>`;
            box.scrollTop = box.scrollHeight;
            let prompt = chatMode === 'interviewer' ? `Strict Interviewer for ${interviewRole}. Ask tough question.` : "Friendly Mentor.";
            try {
                const res = await fetch("https://go.fastrouter.ai/api/v1/chat/completions", {
                    method: "POST", headers: { "Authorization": `Bearer ${API_KEY}`, "Content-Type": "application/json" },
                    body: JSON.stringify({ "model": "openai/gpt-4o", "messages": [ { "role": "system", "content": prompt }, { "role": "user", "content": msg } ] })
                });
                const data = await res.json();
                document.getElementById(loadingId).remove();
                if (data.choices) box.innerHTML += `<div class="flex gap-3 mt-4"><div class="w-8 h-8 rounded-full bg-gray-700 overflow-hidden flex-shrink-0 mt-1"><img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"></div><div class="glass-panel p-3 text-sm text-gray-200 rounded-r-xl rounded-bl-xl max-w-[80%] leading-relaxed border-l-4 border-neon">${marked.parse(data.choices[0].message.content)}</div></div>`;
                box.scrollTop = box.scrollHeight;
            } catch(err) { if(document.getElementById(loadingId)) document.getElementById(loadingId).remove(); }
        }
        
        async function startMockInterview() { const { value: r } = await Swal.fire({ title: 'Role', input: 'select', inputOptions: {'SDE':'SDE', 'PM':'PM'}, background:'#1e293b', color:'#fff' }); if(r) { interviewRole = r; nav('mentor-connect'); setChatMode('interviewer'); } }
    </script>
</body>
</html>